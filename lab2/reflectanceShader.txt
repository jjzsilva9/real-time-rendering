#version 330

uniform samplerCube skybox;
uniform float eta = 0.8;
in vec3 Ra, Re;
in vec3 tnorm;
in vec3 I;

void main(){
	float F_0 = pow((1.0 - eta) / (1.0 + eta), 2.0);

	float cosTheta = max(dot(-I, tnorm), 0.0);
	float fresnel = F_0 + (1.0 - F_0) * pow(1.0 - cosTheta, 5.0);

	vec3 reflection = texture(skybox, Re).rgb;
	vec3 refraction = texture(skybox, Ra).rgb;

	vec3 final = mix(refraction, reflection, fresnel);
	gl_FragColor = vec4(final, 1.0);
}